<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    
    <title>Ryan Jan  | vROps Reports and PowerCLI Part 2: Downloading Reports</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">

    <meta name="generator" content="Hugo 0.55.6" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    <link rel="stylesheet" type="text/css" href="/css/screen.css" />
    
    
    <link rel="stylesheet" type="text/css" href="/css/prism.css" />
    <link rel="stylesheet" type="text/css" href="/css/custom/global-custom.css" />
    <link rel="stylesheet" type="text/css" href="/css/custom/screen-custom.css" />
    <link rel="stylesheet" type="text/css" href="/css/fontawesome_all.min.css" /> 
    <link rel="stylesheet" type="text/css" href="/css/custom/prism-custom.css" />

    
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
</head>




<body class='post-template' >
    <div class="site-wrapper">
        
<header class="site-header outer" no-cover>
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="http://ryan-jan.github.io/"><img src="/images/ryanjan-logo.png" alt="Ryan Jan" /></a>
        
        <ul class="nav" role="menu">
            <li class="nav-home" role="menuitem"><a href="http://ryan-jan.github.io/">Home</a></li>
            <li class="nav-about" role="menuitem"><a href="http://ryan-jan.github.io//about">About</a></li>
        </ul>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            <a class="social-link social-link-gh" href="https://github.com/ryan-jan" target="_blank" rel="noopener">
                <i class="fab fa-github fa-lg"></i>
            </a>
            <a class="social-link social-link-tw" href="https://twitter.com/_ryanjan_" target="_blank" rel="noopener">
                <i class="fab fa-twitter fa-lg"></i>
            </a>
        </div>
    </div>
</nav>
    </div>
</header>
<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime='21 May 2018'>21 May 2018</time>
                    
                    
                    
                        <span class="date-divider">/</span> <a href="/tags/vrops">vrops</a>
                    
                    
                </section>
                <h1 class="post-full-title">vROps Reports and PowerCLI Part 2: Downloading Reports</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url( '/images/2018/05/vmw-vrealize-operations-fast-facts-1.jpg' )">
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    

<p>For your reference, here are the articles in this mini-series:</p>

<ul>
<li><a href="https://ryanjan.uk/2018/05/16/running-vrops-reports-using-powercli/">vROps Reports and PowerCLI Part 1: Generating Reports</a></li>
<li><a href="#">vROps Reports and PowerCLI Part 2: Downloading Reports</a> (this article)</li>
<li><a href="https://ryanjan.uk/2018/06/24/vrops-reports-and-powercli-part-three-a-helper-module/">vROps Reports and PowerCLI Part 3: A Helper Module</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>Following on from the <a href="https://ryanjan.uk/2018/05/16/running-vrops-reports-using-powercli/">previous article</a> in this mini-series, this article demonstrates how to retrieve a generated report from vROps as a PowerShell object.</p>

<h2 id="downloading-a-generated-report">Downloading A Generated Report</h2>

<p>The last step of the <a href="https://ryanjan.uk/2018/05/16/running-vrops-reports-using-powercli/">previous article</a> was to use the <code>GetReport()</code> method to verify that your report generation was complete.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReport(&quot;5ef2e8c9-09bb-4a74-b560-f9ad2e810854&quot;)

Name               :
Description        : Oversized VMs Report.
ResourceId         : 26717f44-cd8d-486a-821f-e1df41bb49b3
ReportDefinitionId : 1f69952f-7ff4-4d2c-9446-81a811de19b0
TraversalSpec      :
Subject            : VirtualMachine VirtualMachine
Owner              : f315d79d-72ac-46ff-a512-cb43073246c3
CompletionTime     : Wed May 16 12:07:50 BST 2018
Status             : COMPLETED
Links              : {linkToSelf, linkToResource, linkToReportDefinition}
Any                :
Id                 : 5ef2e8c9-09bb-4a74-b560-f9ad2e810854
AnyAttr    
</code></pre>

<p>Let&rsquo;s take a look at the properties and methods of the <code>GetReport()</code> method using the <code>Get-Member</code> cmdlet.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReport(&quot;5ef2e8c9-09bb-4a74-b560-f9ad2e810854&quot;) | Get-Member

   TypeName: VMware.VimAutomation.VROps.Views.Report

Name                MemberType Definition
----                ---------- ----------
DownloadReport      Method     void DownloadReport(System.IO.Stream outputStream, string format)
DownloadReportAsync Method     System.Threading.Tasks.Task DownloadReportAsync(System.Threading.CancellationToken cancellationToken, System.IO.Stream outputStream, string format), System.Threading.Tasks.T...
Equals              Method     bool Equals(System.Object obj)
GetHashCode         Method     int GetHashCode()
GetType             Method     type GetType()
ToString            Method     string ToString()
Any                 Property   System.Xml.XmlElement[] Any {get;set;}
AnyAttr             Property   System.Xml.XmlAttribute[] AnyAttr {get;set;}
CompletionTime      Property   string CompletionTime {get;set;}
Description         Property   string Description {get;set;}
Id                  Property   string Id {get;set;}
Links               Property   VMware.VimAutomation.VROps.Views.LinkTag[] Links {get;set;}
Name                Property   string Name {get;set;}
Owner               Property   string Owner {get;set;}
ReportDefinitionId  Property   string ReportDefinitionId {get;set;}
ResourceId          Property   string ResourceId {get;set;}
Status              Property   string Status {get;set;}
Subject             Property   string Subject {get;set;}
TraversalSpec       Property   VMware.VimAutomation.VROps.Views.TraversalSpec TraversalSpec {get;set;}
</code></pre>

<p>Right at the top of that list is <code>DownloadReport()</code>, which is the method that we are after. To see which properties the <code>DownloadReport()</code> method expects as its inputs, we can call the method on its own.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReport(&quot;5ef2e8c9-09bb-4a74-b560-f9ad2e810854&quot;).DownloadReport

OverloadDefinitions
-------------------
void DownloadReport(System.IO.Stream outputStream, string format)
</code></pre>

<p>This tells us that it requires two inputs: (1) a <code>System.IO.Stream</code> object; and (2) a string specifying the format in which to download the report. The API documentation states that the format can be either <code>PDF</code> or <code>CSV</code>. If not specified, the default is <code>PDF</code>. Given that we are trying to convert this report into a PowerShell object, a <code>PDF</code> is useless to us; therefore, we need to make sure that we specify <code>CSV</code>.</p>

<p>First, we will create a <code>System.IO.Stream</code> object. The <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io">.NET API documentation</a> for the <code>System.IO</code> namespace helpfully lists the available stream classes. We&rsquo;ll be using the <code>MemoryStream</code> class. You can create a <code>MemoryStream</code> object in PowerShell as follows:</p>

<pre><code class="language-powershell">$MemoryStream = New-Object System.IO.MemoryStream
</code></pre>

<p>Now we run the <code>DownloadReport()</code> method with the <code>$MemoryStream</code> object, making sure to specify <code>CSV</code> as the format.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReport(&quot;5ef2e8c9-09bb-4a74-b560-f9ad2e810854&quot;).DownloadReport($MemoryStream, &quot;CSV&quot;)
</code></pre>

<p>Once we have received our report into the <code>$MemoryStream</code> object, we need to use a <code>System.IO.StreamReader</code> object to read the stream. But before we create this object, we need to set the current position of the <code>$MemoryStream</code> back to its starting point.</p>

<pre><code class="language-powershell">$MemoryStream.Seek(0, &quot;Begin&quot;)
$ReadStream = New-Object System.IO.StreamReader($MemoryStream)
</code></pre>

<p>With the <code>$ReadStream</code> object populated with the <code>$MemoryStream</code> data, we can now loop through the <code>$ReadStream</code> line by line and write the data to the console.</p>

<pre><code class="language-powershell">while ($ReadStream.Peek() -ne -1) {
    $ReadStream.ReadLine()
}
</code></pre>

<p>I&rsquo;ve used the <code>Peek()</code> method of the <code>System.IO.StreamReader</code> object to identify the end of the stream (when it returns <code>-1</code>). Again, the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.streamreader.peek">.NET API documentation</a> is a great resource to find these methods and to see how they can be used.</p>

<p>Hopefully, each line of your report has been written to your PowerShell console, which is great. So, to convert this data into a PowerShell object, we will first store it as a string.</p>

<pre><code class="language-powershell">while ($ReadStream.Peek() -ne -1) {
    $Output += $ReadStream.ReadLine()
    $Output += &quot;`n&quot;
}
</code></pre>

<p>With this slight tweak of the <code>while</code> loop, we are now appending each line from the <code>$ReadStream</code> object to a new <code>$Output</code> object, which is a string. Because this is a string you will notice that I am having to tell it where to break for a new line with <code>`n</code>, which is the PowerShell special character for &lsquo;new line&rsquo;.</p>

<p>We now have our report, represented as a string of <code>CSV</code> data, stored in the <code>$Output</code> object. This makes it very easy to convert this string of data into a PowerShell object using the <code>ConvertFrom-Csv</code> cmdlet!</p>

<pre><code class="language-powershell">$Output | ConvertFrom-Csv
</code></pre>

<p>And there you have it: your vROps report is now a PowerShell object.</p>

<h2 id="next-steps">Next Steps</h2>

<p>The first two articles in this mini-series have hopefully shown you how to use the vROps API, together with PowerCLI to generate and download reports as a PowerShell object. However, I appreciate that it is quite a long and cumbersome process. This is why I have been working on a helper module, which will tie together all of the steps from these articles into easy-to-use cmdlets. Check back for part 3 where I will show you the module and how you can download it.</p>

                </div>
            </section>
            <footer class="post-full-footer">
                <section class="author-card">
    <img class="author-profile-image" src="/images/profile_images/ryan.jpg" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="#">Ryan Kowalewski</a></h4>
        <p>I am a Virtualisation Technical Specialist for a FTSE 100 company in the UK. My role focusses mainly on VMware and automation.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="#">Read More</a>
</div>

            </footer>
        </article>

    </div>
</main>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="http://ryan-jan.github.io/">
            <img src="/images/favicon.png" alt="Ryan Jan icon" />
            <span>Ryan Jan</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">vROps Reports and PowerCLI Part 2: Downloading Reports</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this</i></div>
        <a class="floating-header-share-tw"
            href="https://twitter.com/share?text=vROps%20Reports%20and%20PowerCLI%20Part%202%3a%20Downloading%20Reports&amp;url=http%3a%2f%2fryan-jan.github.io%2f2018%2f05%2f21%2fvrops-reports-and-powercli-part-two-downloading-reports%2f"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fryan-jan.github.io%2f2018%2f05%2f21%2fvrops-reports-and-powercli-part-two-downloading-reports%2f"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <i class="fab fa-facebook-f fa-lg"></i>
        </a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
             <article class="post-card post" >
    
    <a class="post-card-image-link" href="http://ryan-jan.github.io/2018/06/02/powershell-tips-script-optimization/">
        <div class="post-card-image" style="background-image: url('/images/2018/06/lum3n-193427-unsplash.jpg')"></div>
    </a>
    
    <div class="post-card-content">
        <a class="post-card-content-link" href="http://ryan-jan.github.io/2018/06/02/powershell-tips-script-optimization/">
            <header class="post-card-header">
                
                
                
                    <span class="post-card-tags">powershell</span>
                
                
                <h2 class="post-card-title">PowerShell Tips: Script Optimization</h2>
            </header>
            <section class="post-card-excerpt">
                
                <p>Introduction A colleague of mine recently asked for some help with a script he was writing. We use vSphere tags in order to determine which backup schedule a given VM is in and he wanted to find all VMs which were not assigned a tag in the category backup-service-level, and therefore were not being …</p>
                
            </section>
        </a>
        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <div class="author-name-tooltip">
                        Ryan Kowalewski
                    </div>
                    <a href="http://ryan-jan.github.io/2018/06/02/powershell-tips-script-optimization/" class="static-avatar">
                        
                        <img class="author-profile-image" src="/images/profile_images/ryan.jpg" alt="Ryan Kowalewski" />
                        
                    </a>
                </li>
            </ul>
            <span class="reading-time">3 mins</span>
        </footer>
    </div>
</article> 
            <article class="post-card post" >
    
    <a class="post-card-image-link" href="http://ryan-jan.github.io/2018/05/16/running-vrops-reports-using-powercli/">
        <div class="post-card-image" style="background-image: url('/images/2018/05/vmw-vrealize-operations-fast-facts.jpg')"></div>
    </a>
    
    <div class="post-card-content">
        <a class="post-card-content-link" href="http://ryan-jan.github.io/2018/05/16/running-vrops-reports-using-powercli/">
            <header class="post-card-header">
                
                
                
                    <span class="post-card-tags">vrops</span>
                
                
                <h2 class="post-card-title">vROps Reports and PowerCLI Part 1: Generating Reports</h2>
            </header>
            <section class="post-card-excerpt">
                
                <p>For your reference, here are the articles in this mini-series:
 vROps Reports and PowerCLI Part 1: Generating Reports (this article) vROps Reports and PowerCLI Part 2: Downloading Reports vROps Reports and PowerCLI Part 3: A Helper Module  Introduction I&rsquo;ve been spending quite a bit of time …</p>
                
            </section>
        </a>
        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
                    <div class="author-name-tooltip">
                        Ryan Kowalewski
                    </div>
                    <a href="http://ryan-jan.github.io/2018/05/16/running-vrops-reports-using-powercli/" class="static-avatar">
                        
                        <img class="author-profile-image" src="/images/profile_images/ryan.jpg" alt="Ryan Kowalewski" />
                        
                    </a>
                </li>
            </ul>
            <span class="reading-time">7 mins</span>
        </footer>
    </div>
</article>
        </div>
    </div>
</aside>


        <footer class="site-footer outer">
    <div class="site-footer-content inner">
        <section class="copyright"><a href="http://ryan-jan.github.io/">Ryan Jan</a> &copy; 2019</section>
        <nav class="site-footer-nav">
            <a href="http://ryan-jan.github.io/">Latest Posts</a>
            <a href="https://github.com/ryan-jan" target="_blank" rel="noopener">GitHub</a>
            <a href="https://twitter.com/_ryanjan_" target="_blank" rel="noopener">Twitter</a>
        </nav>
    </div>
</footer>
    </div>

    
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/js/jquery.fitvids.js"></script>

    
    <script type="text/javascript" src="/js/prism.js"></script>
    <script type="text/javascript" src="/js/custom/prism-custom.js"></script>
    
    
<script>
    
    
    
    
    $(document).ready(function () {
        
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        
    
        var progressBar = document.querySelector('#reading-progress');
        var header = document.querySelector('.floating-header');
        var title = document.querySelector('.post-full-title');
    
        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;
    
        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }
    
        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }
    
        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }
    
        function update() {
            var trigger = title.getBoundingClientRect().top + window.scrollY;
            var triggerOffset = title.offsetHeight + 35;
            var progressMax = lastDocumentHeight - lastWindowHeight;
    
            
            if (lastScrollY >= trigger + triggerOffset) {
                header.classList.add('floating-active');
            } else {
                header.classList.remove('floating-active');
            }
    
            progressBar.setAttribute('max', progressMax);
            progressBar.setAttribute('value', lastScrollY);
    
            ticking = false;
        }
    
        window.addEventListener('scroll', onScroll, {passive: true});
        window.addEventListener('resize', onResize, false);
    
        update();
    
    });
</script>

</body>
</html>