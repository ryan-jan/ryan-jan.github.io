<!DOCTYPE html>
<html>
<head>
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-119235055-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-119235055-1');
  </script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  
  <title>Ryan Jan  | vROps Reports and PowerCLI Part 1: Generating Reports</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <meta name="generator" content="Hugo 0.55.6" />
  
  
    <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
  

  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  
  
  <link rel="stylesheet" type="text/css" href="/css/prism.css" />
  <link rel="stylesheet" type="text/css" href="/css/custom/global-custom.css" />
  <link rel="stylesheet" type="text/css" href="/css/custom/screen-custom.css" />
  <link rel="stylesheet" type="text/css" href="/css/fontawesome_all.min.css" /> 
  <link rel="stylesheet" type="text/css" href="/css/custom/prism-custom.css" />

  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700" rel="stylesheet">
</head>




<body class='post-template' >
  <div class="site-wrapper">
    
<header class="site-header outer" no-cover>
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
        <a class="site-nav-logo" href="https://ryanjan.uk/"><img src="/images/ryanjan-logo.png" alt="Ryan Jan" /></a>
        
        <ul class="nav" role="menu">
            <li class="nav-home" role="menuitem"><a href="https://ryanjan.uk/">Home</a></li>
            <li class="nav-about" role="menuitem"><a href="https://ryanjan.uk//about">About</a></li>
        </ul>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            <a class="social-link social-link-gh" href="https://github.com/ryan-jan" target="_blank" rel="noopener">
                <i class="fab fa-github fa-lg"></i>
            </a>
            <a class="social-link social-link-tw" href="https://twitter.com/_ryanjan_" target="_blank" rel="noopener">
                <i class="fab fa-twitter fa-lg"></i>
            </a>
        </div>
    </div>
</nav>
    </div>
</header>
<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime='16 May 2018'>16 May 2018</time>
                    
                    
                    
                        <span class="date-divider">/</span> <a href="/tags/vrops">vrops</a>
                    
                    
                </section>
                <h1 class="post-full-title">vROps Reports and PowerCLI Part 1: Generating Reports</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url( '/images/2018/05/vmw-vrealize-operations-fast-facts.jpg' )">
            </figure>
            

            <section class="post-full-content">
                <div class="post-content">
                    

<p>For your reference, here are the articles in this mini-series:</p>

<ul>
<li><a href="#">vROps Reports and PowerCLI Part 1: Generating Reports</a> (this article)</li>
<li><a href="https://ryanjan.uk/2018/05/21/vrops-reports-and-powercli-part-two-downloading-reports/">vROps Reports and PowerCLI Part 2: Downloading Reports</a></li>
<li><a href="https://ryanjan.uk/2018/06/24/vrops-reports-and-powercli-part-three-a-helper-module/">vROps Reports and PowerCLI Part 3: A Helper Module</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>I&rsquo;ve been spending quite a bit of time with vRealize Operations Manager (vROps) lately, mostly running reports. While this is easy enough to do via the web UI, I found myself running a report, downloading the <code>.csv</code>, and then importing the data into PowerShell to work with it. Obviously, I turned to PowerCLI to see if I could do this all in PowerShell! However, I quickly vRealized (see what I did there) that the vROps PowerCLI module currently does not contain many Cmdlets, as shown below.</p>

<pre><code class="language-powershell">Get-Command -Module VMware.VimAutomation.vROps

CommandType     Name                                               Version    Source
-----------     ----                                               -------    ------
Function        Get-vROpsCommand                                   10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Connect-OMServer                                   10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Disconnect-OMServer                                10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMAlert                                        10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMAlertDefinition                              10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMAlertSubType                                 10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMAlertType                                    10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMRecommendation                               10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMResource                                     10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMStat                                         10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMStatKey                                      10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Get-OMUser                                         10.0.0.... VMware.VimAutomation.vROps
Cmdlet          Set-OMAlert                                        10.0.0.... VMware.VimAutomation.vROps
</code></pre>

<p>Don&rsquo;t get me wrong - this is a good start but doesn&rsquo;t help me run reports. So, I had a look around online and found a great blog post by <a href="https://twitter.com/johnddias">John Dias</a> on <a href="https://blogs.vmware.com/PowerCLI/2016/05/using-entire-api-vrealize-operations-via-powercli.html">using the entire vROps REST API via PowerCLI</a>. I won&rsquo;t go into massive detail because I think John is far more informative than I would be, but essentially it explains that the entire vROps API is available by manipulating the <code>extensionData</code> container via PowerCLI.</p>

<p>For example: if you connect to your vROps server as follows,</p>

<pre><code class="language-powershell">$vrops = Connect-OMServer -Server vrops.example.com -User &quot;admin&quot; -Password &quot;Password&quot; -AuthSource &quot;Local Users&quot;
</code></pre>

<p>You can then use the <code>$vrops</code> object to access the <code>extensionData</code>. Piping to the <code>Get-Member</code> Cmdlet allows you to see all of the properties and methods available.</p>

<pre><code class="language-powershell">$vrops.ExtensionData | Get-Member

   TypeName: VMware.VimAutomation.VROps.Views.ServerApi

Name                                          MemberType Definition
----                                          ---------- ----------
AcquireToken                                  Method     VMware.VimAutomation.VROps.Views.AuthToken AcquireToken(VMware.VimAutomation.VROps.Views.UsernamePassword input)
AcquireTokenAsync                             Method     System.Threading.Tasks.Task[VMware.VimAutomation.VROps.Views.AuthToken] AcquireTokenAsync(System.Threading.CancellationToken cancellationToken, V...
AddAuthSource                                 Method     VMware.VimAutomation.VROps.Views.AuthSource AddAuthSource(VMware.VimAutomation.VROps.Views.AuthSource input)
AddAuthSourceAsync                            Method     System.Threading.Tasks.Task[VMware.VimAutomation.VROps.Views.AuthSource] AddAuthSourceAsync(System.Threading.CancellationToken cancellationToken,...
AddLicenseKeyToProduct                        Method     VMware.VimAutomation.VROps.Views.SolutionLicenses AddLicenseKeyToProduct(VMware.VimAutomation.VROps.Views.SolutionLicenses input)
AddLicenseKeyToProductAsync                   Method     System.Threading.Tasks.Task[VMware.VimAutomation.VROps.Views.SolutionLicenses] AddLicenseKeyToProductAsync(System.Threading.CancellationToken can...
AddStatsForResources                          Method     void AddStatsForResources(VMware.VimAutomation.VROps.Views.ResourcesStatContents input, System.Nullable[bool] disableAnalyticsProcessing)
AddStatsForResourcesAsync                     Method     System.Threading.Tasks.Task AddStatsForResourcesAsync(System.Threading.CancellationToken cancellationToken, VMware.VimAutomation.VROps.Views.Reso...
AddStatsForResourcesUsingPushAdapterKind      Method     void AddStatsForResourcesUsingPushAdapterKind(string adapterKind, VMware.VimAutomation.VROps.Views.ResourcesStatContents input, System.Nullable[b...
AddStatsForResourcesUsingPushAdapterKindAsync Method     System.Threading.Tasks.Task AddStatsForResourcesUsingPushAdapterKindAsync(System.Threading.CancellationToken cancellationToken, string adapterKin...
ChangePassword                                Method     void ChangePassword(VMware.VimAutomation.VROps.Views.PasswordChange input)
ChangePasswordAsync                           Method     System.Threading.Tasks.Task ChangePasswordAsync(System.Threading.CancellationToken cancellationToken, VMware.VimAutomation.VROps.Views.PasswordCh...
</code></pre>

<p>I have cut the list short as there are hundreds of properties and methods available, but you can see that this is how all the vROps REST API methods are made available in PowerCLI.</p>

<p>With this information, and the vROps API documentation that can be accessed via your vROps appliance (e.g. <code>http://vrops.example.com/suite-api</code>), I was able to generate and download a report as a <code>powershell</code> object. This mini-series will guide you through how I did it, starting with generating a report.</p>

<h2 id="generating-a-report">Generating A Report</h2>

<p>The first step is to generate a report. This is made possible by the <code>CreateReport()</code> method of the <code>extensionData</code> container. Looking at the API documentation, you will see that this method takes the <code>&lt;ns3:report&gt;</code> object as its input. The <code>&lt;ns3:report&gt;</code> model shows that it has the following three required properties.</p>

<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Required</th>
</tr>
</thead>

<tbody>
<tr>
<td>resourceId</td>
<td>Resource identifier for which the Report needs to be generated.</td>
<td>xs:uuid</td>
<td>yes</td>
</tr>

<tr>
<td>reportDefinitionId</td>
<td>Identifier of the Report Definition used to generate this Report.</td>
<td>xs:uuid</td>
<td>yes</td>
</tr>

<tr>
<td>traversalSpec</td>
<td>The traversal spec for which the Report Definition needs to be applied.</td>
<td>ns3:traversal-spec</td>
<td>yes</td>
</tr>
</tbody>
</table>

<p>Let&rsquo;s take a look at getting the <code>resourceId</code> first, as there is already a <code>cmdlet</code> for this in the <code>VMware.VimAutomation.vROps</code> module. So, if I wanted to get the <code>Id</code> for the vSphere World resource, I would use the following.</p>

<pre><code class="language-powershell">Import-Module VMware.VimAutomation.vROps
Get-OMResource -Name &quot;vSphere World&quot; | Select-Object Id

Id
--
26717f44-cd8d-486a-821f-e1df41bb49b3
</code></pre>

<p>That was easy. Next, let&rsquo;s take a look at getting the <code>reportDefinitionId</code> for the report that we want to generate. In this example, I am going to use the Oversized VMs report. Unfortunately, there is not a <code>cmdlet</code> for this yet, so we have to use the <code>extensionData</code> container as explained previously. If you haven&rsquo;t done so already, connect to your vROps instance like so.</p>

<pre><code class="language-powershell">$vrops = Connect-OMServer -Server vrops.example.com -User &quot;admin&quot; -Password &quot;Password&quot; -AuthSource &quot;Local Users&quot;
</code></pre>

<p>Now, we can use the <code>GetReportDefinitions()</code> method to search through the available reports and find the <code>Id</code> of the report that we want. I&rsquo;m using the third parameter of this method to filter the results by name.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReportDefinitions($null, $null, &quot;Oversized Virtual Machines&quot;).ReportDefinition

Name                 : Optimization Report - Oversized Virtual Machines
Description          : Oversized VMs Report.
Subject              : {Virtual Machine}
Traversalspecs       : {vSphere Networking, Custom Datacenters, vCAC CDC View, VM Dependency...}
LastRunTime          : 01/01/0001 00:00:00
LastRunTimeSpecified : False
Owner                : admin
Links                :
Any                  :
Id                   : 1f69952f-7ff4-4d2c-9446-81a811de19b0
CreationTime         : 01/01/0001 00:00:00
Active               : True
ActiveSpecified      : True
AnyAttr              :
</code></pre>

<p>I hope you agree that that also wasn&rsquo;t too difficult. However, now comes the slightly trickier part. We need to use a <code>traversalSpec</code> to tell vROps which inventory to traverse when generating the report. You can list all available <code>traversalSpecs</code> by calling the <code>GetTraversalSpecs()</code> method.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetTraversalSpecs().TraversalSpec
</code></pre>

<p>You may have noticed when looking at the <code>&lt;ns3:report&gt;</code> model previously that the <code>traversalSpec</code> property actually expects to receive a <code>&lt;ns3:traversal-spec&gt;</code> object, not a string <code>Id</code> as is the case with the other two properties. Therefore, we need to create a <code>traversalSpec</code> object to use with the <code>CreateReport()</code> method. I am targeting the vSphere Hosts and Clusters <code>traversalSpec</code> for this example, so let&rsquo;s filter the results from the previous command.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetTraversalSpecs($null, $null, &quot;vSphere Hosts and Clusters&quot;).TraversalSpec

Name                       : vSphere Hosts and Clusters
Description                : Enables view of resources imported from vCenter like Clusters, Hosts, VMs and ResourcePools
RootAdapterKindKey         : VMWARE
RootResourceKindKey        : vSphere World
Any                        :
AdapterInstanceAssociation : False
AnyAttr                    :
</code></pre>

<p>We can use this information to build a <code>traversalSpec</code> object. If you look at the API documentation for the <code>&lt;ns3:traversal-spec&gt;</code> model, you will find that there is only one required property, which is the <code>Name</code>. However, during testing I found that I also needed to specify the <code>RootAdapterKindKey</code> and the <code>RootResourceKindKey</code>. Therefore, we can create the object and assign the property values as follows.</p>

<pre><code class="language-powershell">$TraversalSpec = New-Object VMware.VimAutomation.VROps.Views.TraversalSpec
$TraversalSpec.Name = &quot;vSphere Hosts and Clusters&quot;
$TraversalSpec.RootAdapterKindKey = &quot;VMWARE&quot;
$TraversalSpec.RootResourceKindKey = &quot;vSphere World&quot;
</code></pre>

<p>Now we have all of the required properties for the <code>&lt;ns3:report&gt;</code> object we can piece this all together and finally generate the report!</p>

<p>First, we need to create a report object in our PowerShell session.</p>

<pre><code class="language-powershell">$Report = New-Object VMware.VimAutomation.VROps.Views.Report
</code></pre>

<p>Next, we can set the three required properties on the report object using the information we just collected.</p>

<pre><code class="language-powershell">$Report.ResourceId = &quot;26717f44-cd8d-486a-821f-e1df41bb49b3&quot;
$Report.ReportDefinitionId = &quot;1f69952f-7ff4-4d2c-9446-81a811de19b0&quot;
$Report.TraversalSpec = $TraversalSpec
</code></pre>

<p>Finally, we can run the <code>CreateReport()</code> method to generate the report!</p>

<pre><code class="language-powershell">$vrops.ExtensionData.CreateReport($Report)

Name               :
Description        : Oversized VMs Report.
ResourceId         : 26717f44-cd8d-486a-821f-e1df41bb49b3
ReportDefinitionId : 1f69952f-7ff4-4d2c-9446-81a811de19b0
TraversalSpec      :
Subject            : VirtualMachine VirtualMachine
Owner              : f315d79d-72ac-46ff-a512-cb43073246c3
CompletionTime     : null
Status             : QUEUED
Links              : {linkToSelf, linkToResource, linkToReportDefinition}
Any                :
Id                 : 5ef2e8c9-09bb-4a74-b560-f9ad2e810854
AnyAttr            :
</code></pre>

<p>Congratulations - your report is now being generated! As you can see, its status is currently QUEUED. Depending on the size of your environment, it may take a while to complete. We can use the <code>Id</code> from above to check the status of the report.</p>

<pre><code class="language-powershell">$vrops.ExtensionData.GetReport(&quot;5ef2e8c9-09bb-4a74-b560-f9ad2e810854&quot;)

Name               :
Description        : Oversized VMs Report.
ResourceId         : 26717f44-cd8d-486a-821f-e1df41bb49b3
ReportDefinitionId : 1f69952f-7ff4-4d2c-9446-81a811de19b0
TraversalSpec      :
Subject            : VirtualMachine VirtualMachine
Owner              : f315d79d-72ac-46ff-a512-cb43073246c3
CompletionTime     : Wed May 16 12:07:50 BST 2018
Status             : COMPLETED
Links              : {linkToSelf, linkToResource, linkToReportDefinition}
Any                :
Id                 : 5ef2e8c9-09bb-4a74-b560-f9ad2e810854
AnyAttr            :
</code></pre>

<p>If you log into your vROps web UI, you should now see your generated report.</p>

<h2 id="next-steps">Next Steps</h2>

<p>That was a lot of information but I hope it has helped you to understand the concepts of manipulating the entire vROps API using the <code>extensionData</code> container in PowerCLI and, more specifically, how to generate a report. Check back for part 2 of this mini-series, where I will demonstrate how to retreive the generated report as a PowerShell object.</p>

                </div>
            </section>
            <footer class="post-full-footer">
                
                
                
                    
                        <section class="author-card">
    
    
    <img class="author-profile-image" src="/authors/ryan/avatar_hu556f9c2eb9e01da7c273187f0f4fea39_39403_60x60_fill_q75_box_center.jpg" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="/authors/ryan/">Ryan Kowalewski</a></h4>
        <p><p>Ryan is a Virtualisation Technical Specialist for a FTSE 100 company in the UK. His role focusses mainly on VMware and automation.</p>
</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="/authors/ryan/">Read More</a>
</div>

                    
                
            </footer>
        </article>

    </div>
</main>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://ryanjan.uk/">
            <img src="/images/favicon.png" alt="Ryan Jan icon" />
            <span>Ryan Jan</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">vROps Reports and PowerCLI Part 1: Generating Reports</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this</i></div>
        <a class="floating-header-share-tw"
            href="https://twitter.com/share?text=vROps%20Reports%20and%20PowerCLI%20Part%201%3a%20Generating%20Reports&amp;url=https%3a%2f%2fryanjan.uk%2f2018%2f05%2f16%2frunning-vrops-reports-using-powercli%2f"
            target="_blank">
            <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fryanjan.uk%2f2018%2f05%2f16%2frunning-vrops-reports-using-powercli%2f"
            target="_blank">
            <i class="fab fa-facebook-f fa-lg"></i>
        </a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
             <article class="post-card post" >
    
    <a class="post-card-image-link" href="https://ryanjan.uk/2018/05/21/vrops-reports-and-powercli-part-two-downloading-reports/">
        <div class="post-card-image" style="background-image: url('/images/2018/05/vmw-vrealize-operations-fast-facts-1.jpg')"></div>
    </a>
    
    <div class="post-card-content">
        <a class="post-card-content-link" href="https://ryanjan.uk/2018/05/21/vrops-reports-and-powercli-part-two-downloading-reports/">
            <header class="post-card-header">
                
                
                
                    <span class="post-card-tags">vrops</span>
                
                
                <h2 class="post-card-title">vROps Reports and PowerCLI Part 2: Downloading Reports</h2>
            </header>
            <section class="post-card-excerpt">
                
                <p>For your reference, here are the articles in this mini-series:
 vROps Reports and PowerCLI Part 1: Generating Reports vROps Reports and PowerCLI Part 2: Downloading Reports (this article) vROps Reports and PowerCLI Part 3: A Helper Module  Introduction Following on from the previous article in this …</p>
                
            </section>
        </a>
        <footer class="post-card-meta">
            <ul class="author-list">
                
                    
                    
                    <li class="author-list-item">
                        <div class="author-name-tooltip">
                            Ryan Kowalewski
                        </div>
                        
                        <a href="https://ryanjan.uk/authors/ryan/" class="static-avatar">
                            
                            
                            <img class="author-profile-image" src="/authors/ryan/avatar_hu556f9c2eb9e01da7c273187f0f4fea39_39403_60x60_fill_q75_box_center.jpg" alt="Ryan Kowalewski" />
                            
                        </a>
                    </li>
                    
                
            </ul>
            <span class="reading-time">4 mins</span>
        </footer>
    </div>
</article> 
            <article class="post-card post" >
    
    <a class="post-card-image-link" href="https://ryanjan.uk/2018/03/26/installing-gogs-in-a-freenas-jail/">
        <div class="post-card-image" style="background-image: url('/images/2018/03/gogs-3.png')"></div>
    </a>
    
    <div class="post-card-content">
        <a class="post-card-content-link" href="https://ryanjan.uk/2018/03/26/installing-gogs-in-a-freenas-jail/">
            <header class="post-card-header">
                
                
                
                    <span class="post-card-tags">tutorials</span>
                
                
                <h2 class="post-card-title">Installing Gogs In A FreeNAS Jail</h2>
            </header>
            <section class="post-card-excerpt">
                
                <p>I recently stumbled across the Gogs project whilst looking for self-hosted Git solutions. I run a FreeNAS server at home so I thought I would get the app up and running in a jail. Here is how I did it.
Jail Preparation Create a new jail named gogs and make sure that the jail is up to date by …</p>
                
            </section>
        </a>
        <footer class="post-card-meta">
            <ul class="author-list">
                
                    
                    
                    <li class="author-list-item">
                        <div class="author-name-tooltip">
                            Ryan Kowalewski
                        </div>
                        
                        <a href="https://ryanjan.uk/authors/ryan/" class="static-avatar">
                            
                            
                            <img class="author-profile-image" src="/authors/ryan/avatar_hu556f9c2eb9e01da7c273187f0f4fea39_39403_60x60_fill_q75_box_center.jpg" alt="Ryan Kowalewski" />
                            
                        </a>
                    </li>
                    
                
            </ul>
            <span class="reading-time">2 mins</span>
        </footer>
    </div>
</article>
        </div>
    </div>
</aside>


    <footer class="site-footer outer">
    <div class="site-footer-content inner">
        <section class="copyright"><a href="https://ryanjan.uk/">Ryan Jan</a> &copy; 2019</section>
        <nav class="site-footer-nav">
            <a href="https://ryanjan.uk/">Latest Posts</a>
            <a href="https://github.com/ryan-jan" target="_blank" rel="noopener">GitHub</a>
            <a href="https://twitter.com/_ryanjan_" target="_blank" rel="noopener">Twitter</a>
        </nav>
    </div>
</footer>
  </div>

  
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous">
  </script>
  <script type="text/javascript" src="/js/jquery.fitvids.js"></script>

  
  <script type="text/javascript" src="/js/prism.js"></script>
  <script type="text/javascript" src="/js/custom/prism-custom.js"></script>

  
<script>
    
    
    
    
    $(document).ready(function () {
        
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        
    
        var progressBar = document.querySelector('#reading-progress');
        var header = document.querySelector('.floating-header');
        var title = document.querySelector('.post-full-title');
    
        var lastScrollY = window.scrollY;
        var lastWindowHeight = window.innerHeight;
        var lastDocumentHeight = $(document).height();
        var ticking = false;
    
        function onScroll() {
            lastScrollY = window.scrollY;
            requestTick();
        }
    
        function onResize() {
            lastWindowHeight = window.innerHeight;
            lastDocumentHeight = $(document).height();
            requestTick();
        }
    
        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(update);
            }
            ticking = true;
        }
    
        function update() {
            var trigger = title.getBoundingClientRect().top + window.scrollY;
            var triggerOffset = title.offsetHeight + 35;
            var progressMax = lastDocumentHeight - lastWindowHeight;
    
            
            if (lastScrollY >= trigger + triggerOffset) {
                header.classList.add('floating-active');
            } else {
                header.classList.remove('floating-active');
            }
    
            progressBar.setAttribute('max', progressMax);
            progressBar.setAttribute('value', lastScrollY);
    
            ticking = false;
        }
    
        window.addEventListener('scroll', onScroll, {passive: true});
        window.addEventListener('resize', onResize, false);
    
        update();
    
    });
</script>

</body>
</html>